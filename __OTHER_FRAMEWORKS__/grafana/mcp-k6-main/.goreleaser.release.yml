version: 2

# This configuration is used ONLY for creating the GitHub release from pre-built artifacts.
# It skips the build process entirely and expects archives to already exist in the release/ directory.
# We use a separate dist directory to avoid conflicts with the pre-built artifacts.

dist: release-output

# Skip all builds - we're only creating a release from existing artifacts
builds:
  - skip: true

# Checksum configuration
# Include all pre-built artifacts from the build jobs
checksum:
  name_template: "mcp-k6_{{ .Version }}_checksums.txt"
  algorithm: sha256
  extra_files:
    - glob: release/*.tar.gz
    - glob: release/*.zip
    - glob: release/*.deb
    - glob: release/*.rpm

# GitHub release configuration
release:
  github:
    owner: grafana
    name: mcp-k6

  # Include all pre-built artifacts from the build jobs
  extra_files:
    - glob: release/*.tar.gz
    - glob: release/*.zip
    - glob: release/*.deb
    - glob: release/*.rpm
    - glob: release/homebrew/*.rb

  # Draft release (set to false for automatic publishing)
  draft: true

  # Prerelease detection
  prerelease: auto

  # Release name
  name_template: "v{{ .Version }}"

  # Release footer with installation instructions
  footer: |
    ## Installation

    ### Homebrew (macOS/Linux)

    ```bash
    # Download the formula
    curl -LO https://github.com/grafana/mcp-k6/releases/download/v{{ .Version }}/mcp-k6.rb

    # Install from local file
    brew install ./mcp-k6.rb

    # Verify installation
    mcp-k6 --version
    ```

    **Note:** Tap installation (`brew install grafana/grafana/mcp-k6`) will be available after the formula is merged into [grafana/homebrew-grafana](https://github.com/grafana/homebrew-grafana).

    ### Linux (Debian/Ubuntu)

    ```bash
    # Download and install .deb package (replace {ARCH} with amd64 or arm64)
    curl -LO https://github.com/grafana/mcp-k6/releases/download/v{{ .Version }}/mcp-k6_{{ .Version }}_linux_{ARCH}.deb
    sudo dpkg -i mcp-k6_{{ .Version }}_linux_{ARCH}.deb

    # Verify installation
    mcp-k6 --version
    ```

    ### Linux (RHEL/Fedora/CentOS)

    ```bash
    # Download and install .rpm package (replace {ARCH} with amd64 or arm64)
    curl -LO https://github.com/grafana/mcp-k6/releases/download/v{{ .Version }}/mcp-k6_{{ .Version }}_linux_{ARCH}.rpm
    sudo rpm -i mcp-k6_{{ .Version }}_linux_{ARCH}.rpm

    # Verify installation
    mcp-k6 --version
    ```

    ### Quick Install (All Unix-like systems)

    ```bash
    # Download and extract (replace {OS} and {ARCH} with your platform)
    curl -L https://github.com/grafana/mcp-k6/releases/download/v{{ .Version }}/mcp-k6_{{ .Version }}_{OS}_{ARCH}.tar.gz | tar xz

    # Move to PATH
    sudo mv mcp-k6 /usr/local/bin/

    # Verify installation
    mcp-k6 --version
    ```

    ### Supported Platforms

    - **macOS**: darwin_amd64, darwin_arm64
    - **Linux**: linux_amd64, linux_arm64 (tar.gz, .deb, .rpm)
    - **Windows**: windows_amd64

    ### Checksums

    SHA256 checksums are available in `mcp-k6_{{ .Version }}_checksums.txt`

# Snapshot configuration
snapshot:
  version_template: "{{ .Version }}-SNAPSHOT-{{ .ShortCommit }}"

# Metadata
metadata:
  mod_timestamp: "{{ .CommitTimestamp }}"
